/* Table: PROGRAMMS */

CREATE TABLE PROGRAMMS (
    ID_PROG INTEGER NOT NULL,
    NAME VARCHAR(30) NOT NULL,
    PATH VARCHAR(150) NOT NULL,
    ICON BLOB SUB_TYPE 2 SEGMENT SIZE 1 NOT NULL,
    HASH INTEGER NOT NULL,
    NUM_OF_COMPS INTEGER NOT NULL);





/* Primary keys definition */

ALTER TABLE PROGRAMMS ADD CONSTRAINT PK_PROGRAMMS PRIMARY KEY (ID_PROG);


/* Indices definition */

CREATE INDEX PROGRAMMS_IDX1 ON PROGRAMMS (PATH, NAME);
CREATE INDEX PROGRAMMS_IDX2 ON PROGRAMMS (NUM_OF_COMPS);
CREATE INDEX PROGRAMMS_IDX3 ON PROGRAMMS (HASH);
/* Triggers definition */


SET TERM ^ ;





/* Trigger: PROGRAMMS_AU0 */
CREATE TRIGGER PROGRAMMS_AU0 FOR PROGRAMMS
ACTIVE AFTER UPDATE POSITION 0
as
begin
 update COMPS set HASHSUM=gen_id(GEN_PROG_CHANGE,1)
 where ID in (select ID from PROG_COMPS where ID_PROG=new.ID_PROG);
end
^

/* Trigger: PROGRAMMS_BD0 */
CREATE TRIGGER PROGRAMMS_BD0 FOR PROGRAMMS
ACTIVE AFTER DELETE POSITION 0
as
begin
 delete from PROG_COMPS where ID_PROG=OLD.ID_PROG;
end
^


SET TERM ; ^
